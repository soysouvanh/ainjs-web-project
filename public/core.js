var _doc=document,_win=window,_u=void 0,_$=_doc.getElementById.bind(_doc),_qs=_doc.querySelector.bind(_doc),_qsa=_doc.querySelectorAll.bind(_doc),_new=_doc.createElement.bind(_doc),_={addEvent:function(e,t){return this.attachEvent?this.attachEvent("on"+e,t):this.addEventListener(e,t,!1),this},removeEvent:function(e,t){return this.detachEvent?this.detachEvent("on"+e,t):this.removeEventListener(e,t,!1),this},trigger:function(e){var t;_doc.createEvent?((t=_doc.createEvent("MouseEvents")).initEvent(e,!0,!1),this.dispatchEvent(t)):_doc.createEventObject&&(t=_doc.createEventObject(),this.fireEvent("on"+e,t))}};function ajax(t){var o=null,e=null,r=typeof t.data;if(t.before&&t.before(),!t.hasOwnProperty("url")||""===t.url)return!1;if(void 0===t.responseType&&(t.responseType="text"),window.XMLHttpRequest)(o=new XMLHttpRequest).overrideMimeType&&o.overrideMimeType(t.responseType);else if(window.ActiveXObject)try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(null==o)return alert("Impossible to create XMLHttpRequest instance. Your browser is too old."),!1;try{o.responseType=t.responseType}catch(e){o.onloadstart=function(e){o.responseType=t.responseType}}if(o.onreadystatechange=function(){4==o.readyState&&(o.status<500?t.success&&t.success(o,t):(t.error&&t.error(o),console.log(o)))},"object"==r){for(var n in e="",t.data)e+="&"+n+"="+encodeURIComponent(t.data[n]);e=""!==e?e.substring(1):null}else"string"==r&&""!==(t.data=t.data.trim())&&(e=t.data);t.method="string"==typeof t.method?t.method.toLowerCase():"get","get"!==t.method&&"post"!==t.method&&(t.method="get");r=t.url;if("get"===t.method&&(r=r.trimRight("?"),null!==e&&(r+="?"+e)),o.onprogress=t.progress,o.onerror=t.error,o.onload=t.load,o.onloadend=t.loadEnd,o.open(t.method,r,t.async===_u||t.async),"post"===t.method&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),"object"==typeof t.header)for(var n in t.header)o.setRequestHeader(n,t.header[n]);return o.send(e),t.send&&t.send(),!0}function getParameters(e){var r={};return e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,o){r[t]=decodeURIComponent(o)}),r}function getTemplate(e,t){var o,r=_$(e).innerHTML;for(o in t)r=r.replace(new RegExp("{#"+o+"}","g"),t[o]);return r}function getProperties(e){var t,o={};for(t in e){var r=typeof e[t];"function"!=r&&"object"!=r&&(o[t]=e[t])}return o}function getMaxZIndex(e){for(var t=_doc.querySelectorAll(e||"body *"),o=t.length,r=0,n=_doc.defaultView,a=0;a<o;a++){var i=n.getComputedStyle(t[a],null).getPropertyValue("z-index");"auto"!=i&&(i=parseInt(i,10))>r&&(r=i)}return r}function initializeWindowResizeMessage(e){_win.addEvent("resize",function(e){var t=_win.location;_win.parent.postMessage({url:t.href,pathname:t.pathname,hostname:t.hostname,protocol:t.protocol,port:t.port,width:document.body.offsetWidth,height:document.documentElement.offsetHeight,head:document.head.innerHTML,body:document.body.innerHTML},"https://adminty.loc")}),_win.trigger("resize")}function activeLoader(e){var t=_qs("body"),o="pageLoader",r=_$(o);if(e==_u||e)null==r&&((e=_new("div")).id=o,e.className="loadingLayer",e.innerHTML="<div class='ball1'></div><div class='ball2'></div>",e.style.height=t.scrollHeight+"px",t.appendChild(e),o=_qs("#pageLoader > .ball1"),e=_win.pageYOffset+_win.innerHeight/2-o.offsetTop+"px",o.style.top=e,_qs("#pageLoader > .ball2").style.top=e);else if(null!=r)try{t.removeChild(r)}catch(e){}}function modalForm(e,t,o,r,n){o==_u&&(o="modalFormPanel"),r==_u&&(r="get"),(n=n==_u?{}:n).onSuccess==_u&&(n.onSuccess=function(e,t){_event.onSuccess(e,t)}),n.onError==_u&&(n.onError=function(e){_event.onError(e)}),n.onBefore==_u&&(n.onBefore=function(){activeLoader(!0)}),n.onAfter==_u&&(n.onAfter=function(){var e=_$(this.targetId);if(0<e.children.length){for(var t in e.children)if("STYLE"!=e.children[t].tagName&&"SCRIPT"!=e.children[t].tagName){e.children[t].scrollIntoView(!0);break}}else{var o=_$("pageLoader");e.remove(),null==o&&o.remove()}activeLoader(!1)}),ajax({url:e+",dialog",data:t,targetId:o,success:n.onSuccess,error:n.onError,before:n.onBefore,after:n.onAfter});r=_$(o);null==r&&((r=_new("div")).id=o,_doc.body.appendChild(r)),r.addClass("modal")}function confirmDelete(e){_.confirmDeleteDlg=new Dialog({id:e.id||"confirmDlg",title:e.title,body:e.message,buttons:{okConfirmDlg:{label:e.yesLabel,onClick:function(){_event.post({url:e.url,data:e.parameters,before:function(){activeLoader(!0)},after:function(){activeLoader(!1)},loadEnd:function(){_.confirmDeleteDlg.close(),delete _.confirmDeleteDlg}})},class:"ok"},cancelConfirmDlg:{label:e.noLabel,onClick:"close",class:"cancel"}}})}HTMLElement.prototype.remove==_u&&(HTMLElement.prototype.remove=function(){this.parentNode.removeChild(this)}),HTMLElement.prototype.after==_u&&(HTMLElement.prototype.after=function(){for(var e=arguments,t=e.length,o=0,r=this,n=r.parentNode;o<t;)e[o]instanceof Node?null!=(r=r.nextSibling)?n.insertBefore(e[o],r):n.appendChild(e[o]):n.appendChild(_d.createTextNode(e[o])),++o}),HTMLElement.prototype.hasClass=function(e){return this.className&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(this.className)},HTMLElement.prototype.addClass=function(e){return this.hasClass(e)||(""==this.className?this.className=e:this.className+=" "+e),this},HTMLElement.prototype.removeClass=function(e){return this.className=(" "+this.className+" ").replace(" "+e+" "," ").trim(),this},HTMLElement.prototype.getIndex=function(){return Array.prototype.indexOf.call(this.parentNode.children,this)+1},HTMLElement.prototype.closest==_u&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),HTMLElement.prototype.closest=function(e){var t=this;if(_doc.documentElement.contains(t))do{if(t.matches(e))return t}while(null!==(t=t.parentElement||t.parentNode)&&1==t.nodeType);return null}),HTMLElement.prototype.getClosestParentByClass=function(e){for(var t=!1,o=new RegExp("(^|\\s)"+e+"(\\s|$)"),r=this;r.parentNode&&"BODY"!==r.nodeName;)if((r=r.parentNode).className&&o.test(r.className)){t=!0;break}return t?r:null},HTMLElement.prototype.getClosestParentByNodeName=function(e){for(var t=!1,o=this;o.parentNode;){if((o=o.parentNode).nodeName==e){t=!0;break}if("BODY"==o.nodeName)break}return t?o:null},HTMLElement.prototype.getClosestParentByAttribute=function(e,t){for(var o=!1,r=this;r.parentNode;){if((r=r.parentNode).hasAttribute(e)&&r.getAttribute(e)==t){o=!0;break}if("BODY"==r.nodeName)break}return o?r:null},Node.prototype.addEvent=_.addEvent,Node.prototype.removeEvent=_.removeEvent,Node.prototype.trigger=_.trigger,Window.prototype.addEvent=_.addEvent,Window.prototype.removeEvent=_.removeEvent,Window.prototype.trigger=_.trigger,Number.prototype.format=function(e,t,o){e=this.toFixed(e||2).replace(/\d(?=(\d{3})+\.)/g,"$&"+(t||","));return o==_u?e:e.replace(".",o)},Number.prototype.round=function(e){return(Math.round(this)+"").replace(/\d(?=(\d{3})+$)/g,"$&"+(e||","))},HTMLElement.prototype.setNumber=function(e,t){return this.setAttribute("data-value",e),t!=_u&&(e=e.format(t)),"INPUT"==this.tagName?(this.value=e,this.setAttribute("value",e)):this.innerHTML=e,this},HTMLElement.prototype.offset=function(){var e=this.getBoundingClientRect(),t=_win.pageXOffset||_doc.documentElement.scrollLeft,o=_win.pageYOffset||_doc.documentElement.scrollTop;return{top:e.top+o,left:e.left+t,width:e.width,height:e.height,x:e.x,y:e.y}},HTMLElement.prototype.isDisplayed=function(){return!!(this.offsetWidth||this.offsetHeight||this.getClientRects().length)},HTMLElement.prototype.isVisible=function(){var e=window.getComputedStyle(this);return"0"!==e.width&&"0"!==e.height&&"0"!==e.opacity&&"none"!==e.display&&"hidden"!==e.visibility},Document.prototype.removeEvent=_.removeEvent,Document.prototype.trigger=_.trigger,NodeList.prototype.forEach=Array.prototype.forEach,String.prototype.setCharAt==_u&&(String.prototype.setCharAt=function(e,t){return e>this.length-1||e<0?this:this.substring(0,e)+t+this.substring(e+1)}),String.prototype.toCamelCase=function(){var e=this.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z\d]+/g," ").replace(/[^a-zA-Z0-9]+(.)/g,function(e,t){return t.toUpperCase()});return/^\d/.test(e)?"_"+e:e},Window.prototype.URLSearchParams==_u&&(Window.prototype.URLSearchParams=function(e){this.queryString=e,this.get=function(e){e=new RegExp("[?&]"+e+"=([^&#]*)").exec(this.queryString);return null==e?null:decodeURIComponent(e[1])}});var _event={defaultErrorTitle:"Technical error occurs",defaultErrorMessage:"<p>Please, retry later.</p>",showLoader:function(e){},onSuccess:function(source,parameters){source instanceof XMLHttpRequest&&(source=source.responseText);var c=source.replace(/^\s+/,"").charAt(0),field;if("<"==c||""==c){var jsRe=/<script[^>]*>([.\s\S]+?)<\/script>/g,a=null,html;if(parameters&&(html=source.replace(jsRe,""),parameters.targetId?("string"==typeof parameters.targetId?_$(parameters.targetId):parameters.targetId).innerHTML=html:parameters.appendTo&&("string"==typeof parameters.appendTo?_$(parameters.appendTo):parameters.appendTo).insertAdjacentHTML("beforeend",html)),""!=c)for(;null!==(a=jsRe.exec(source));)eval(a[1])}else{"{"==c?parameters.hasOwnProperty("alertDisabled")&&1==parameters.alertDisabled||(eval("var o="+source),o.fieldId&&(o.hasOwnProperty("title")||(o.title=o.label),null===_$(o.fieldId)&&(field=_qs("#"+parameters.formId+" [id^="+o.fieldId+"]"),field&&(o.fieldId=field.id))),o.title&&o.message&&(parameters.alert&&parameters.alert.before&&_event.onField(parameters.alert.before,o),_form.alert(o),parameters.alert&&parameters.alert.after&&_event.onField(parameters.alert.after,o))):eval(source)}parameters.after&&parameters.after()},onField:function(e,t){e._&&e._(t),e[t.fieldId]&&(e[t.fieldId]._&&e[t.fieldId]._(t),e[t.fieldId][type]&&e[t.fieldId][type](t))},onError:function(e){this.after&&this.after(),_form.alert({title:_event.defaultErrorTitle,message:_event.defaultErrorMessage+"<p>"+e.status+": "+e.statusText+"</p>"})},onProgress:function(e){return e.position/e.totalSize*100},toQuery:function(e){var t=typeof e;if("string"==t)return e;if("object"!=t)return null;var o="";for(key in e)o+="&"+key+"="+encodeURIComponent(e[key]);return o.substring(1)},get:function(parameters){if(!parameters.hasOwnProperty("url")||""===parameters.url)return!1;var t=parameters.url.split("?"),dataType=typeof parameters.data;return 2<=t.length?"string"===dataType&&0<parameters.data.length?parameters.data+="&"+t[1]:parameters.data="object"===dataType?t[1]+"&"+_event.toQuery(parameters.data):t[1]:parameters.hasOwnProperty("data")||(parameters.data=_form.getData(parameters)),parameters.url=t[0],-1===parameters.url.indexOf(",event")&&-1===parameters.url.indexOf(",ws")&&-1===parameters.url.indexOf(",test")&&(parameters.url+=",event"),"function"!=typeof parameters.success&&(parameters.success=function(e,t){_event.onSuccess(e.responseText,t)}),"function"!=typeof parameters.error&&(parameters.error=function(xmlHttpRequest){var source=xmlHttpRequest.responseText,c=source.charAt(0);"{"==c?(eval("var o="+source),o.title&&o.message&&(parameters.alert&&parameters.alert.before&&_event.onField(parameters.alert.before,o),_form.alert(o),parameters.alert&&parameters.alert.after&&_event.onField(parameters.alert.after,o))):eval(source)}),ajax(parameters)},post:function(parameters){if(!parameters.hasOwnProperty("url")||""===parameters.url)return!1;var t=parameters.url.split("?");return-1===t[0].indexOf(",event")&&-1===t[0].indexOf(",ws")&&-1===t[0].indexOf(",test")&&(parameters.url=t[0]+",event",t[1]&&(parameters.url+="?"+t[1])),"function"!=typeof parameters.success&&(parameters.success=function(e,t){_event.onSuccess(e.responseText,t)}),"function"!=typeof parameters.error&&(parameters.error=function(xmlHttpRequest){var source=xmlHttpRequest.responseText,c=source.charAt(0);"{"==c?(eval("var o="+source),o.title&&o.message&&(parameters.alert&&parameters.alert.before&&_event.onField(parameters.alert.before,o),_form.alert(o),parameters.alert&&parameters.alert.after&&_event.onField(parameters.alert.after,o))):eval(source)}),parameters.method="post",ajax(parameters)}},_form={_keyPressEvents:{},init:function(i){var e,t;i.form=_$(i.formId),i.method=(i.form.getAttribute("method")||"get").toLowerCase(),i.okBtn=_$(i.okBtnId||"okBtn"),i.isButton=i.okBtn&&"BUTTON"===i.okBtn.tagName,"function"!=typeof i.error&&(i.error=_event.onError),"function"!=typeof i.progress&&(i.progress=_event.onProgress),i.form.addEvent("submit",function(e){return e.preventDefault(),!1}),_form._keyPressEvents[i.formId]={parameters:i,submit:function(){if(i.before&&i.before(),"post"===i.method){i.dataName===_u||null===i.dataName||""==i.dataName?i.data=_form.getData(i):(i.data!==_u&&null!==i.data||(i.data={}),i.data[i.dataName]=_form.getJson(i.formId));var e=window.location.search;if(""!=e){var t=e.substring(1).split("&"),o=t.length;if(0<o)for(var r=typeof i.data,n=0;n<o;n++){var a=t[n].split("=");null==_$(a[0])&&("string"==r?(0<i.data.length&&(i.data+="&"),i.data+=t[n]):"object"==r&&(i.data[a[0]]=a[1]!=_u?a[1]:""))}}}return i.url=i.isButton?i.form.getAttribute("action"):i.okBtn.getAttribute("href"),_event[i.method](i),!1}},i.focusId&&_$(i.focusId).focus(),i.selector||(i.selector="#"+i.formId+" input, #"+i.formId+" select"),i.okBtn.addEvent("click",_form._keyPressEvents[i.formId].submit),i.form.parentNode.hasClass("modal")&&(e=_new("a"),t=_qs("#"+i.formId+" button.cancel"),e.className="close",e.setAttribute("href","javascript:void(0)"),e.innerHTML="✖",e.addEvent("click",function(){this.parentNode.parentNode.remove()}),i.form.appendChild(e),t&&t.addEvent("click",function(){e.click()}))},getJson:function(e){var i={};return _qsa("#"+e+" input, #"+e+" select, #"+e+" textarea").forEach(function(e){var t=e.getAttribute("name"),o=null===t||t===_u||""==t?e.id:t,t=e.getAttribute("type")||e.tagName.toLowerCase();if(""!=o)if("radio"==t)e.checked&&(i[o]=e.value);else if("checkbox"==t||"select"==t)if(i[o]==_u&&(i[o]=[]),"checkbox"==t)e.checked&&i[o].push(e.value);else for(var r=e.options,n=r.length,a=0;a<n;a++)r[a].selected&&i[o].push(r[a].value);else i[o]=e.value}),JSON.stringify(i)},getData:function(e){var r="";return _qsa("#"+e.formId+" input, #"+e.formId+" select, #"+e.formId+" textarea").forEach(function(e){var t=e.getAttribute("name"),t=null===t||t===_u||""==t?e.id:t,o=e.getAttribute("type");""!=t&&("checkbox"!=o&&"radio"!=o||e.checked)&&(r+="&"+t+"="+encodeURIComponent(e.value))}),r.substring(1)},alert:function(e,t){new Dialog({title:e.title,body:e.message,focusId:e.alias||e.fieldId||null,onClose:t})},check:function(e,t){return!0},initCharactersRemaining:function(e,r,n){_qsa(e).forEach(function(e){var t=_new("span"),o=e.getAttribute("maxlength");t.setAttribute("class","charactersRemaining"),t.innerHTML="<span id='"+e.id+"CR'>"+o+"</span>/"+o+" <span id='"+e.id+"Txt'>"+r+"</span>",e.parentNode.insertBefore(t,e),e.addEvent("keyup",function(e){var e=e.target||e.srcElement,t=parseInt(e.getAttribute("maxlength"),10),o=_$(e.id+"CR"),t=t-parseInt(e.value.length,10);o.innerHTML=t,_$(e.id+"Txt").innerHTML=1<t?r:n}),e.trigger("keyup")})},post:function(e,t){var o,r=_new("form");for(o in r.method="post",r.action=e,t){var n=_new("input");n.type="text",n.name=o,n.value=t[o],r.appendChild(n)}r.className="hidden",_qs("body").appendChild(r),r.submit()}},_image={widthMax:1080,heightMax:608,thumbnailWidth:120,thumbnailHeight:67,resize:function(n,a){var e,t=_$(n.fileId);t&&0==(t=t.files[0]).type.indexOf("image")&&((e=new FileReader).onload=function(e){var r=new Image;r.src=e.target.result,r.onload=function(){var e=r.width,t=r.height,o=(e>n.width&&(t*=n.width/e,e=n.width),t>n.height&&(e*=n.height/t,t=n.height),document.createElement("canvas"));o.width=e,o.height=t,r.width=e,r.height=t,o.getContext("2d").drawImage(this,0,0,e,t),a(o)}},e.readAsDataURL(t))}},_cookie={set:function(e,t,o){var r,n="";o&&((r=new Date).setTime(r.getTime()+24*o*60*60*1e3),n="; expires="+(0<o?r.toUTCString():"Thu, 01 Jan 1970 00:00:01 GMT")),document.cookie=e+"="+t+n+"; path=/; secure"},get:function(e){for(var t,o=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(t=r[n];" "==t.charAt(0);)t=t.substring(1,t.length);if(0==t.indexOf(o))return t.substring(o.length,t.length)}return null},remove:function(e){_cookie.set(e,"",-10)}};function Draggable(e){var t=this;t.tag=_$(e),t.tag&&(t.isDragging=!1,t.dragOffset={x:0,y:0},t.body=document.documentElement.scrollLeft?document.documentElement:document.body,t.init(document.body))}function Dialog(e){var t=this;t._maxWidth="640px",t._maxHeight="736px",t.id="dlg",t.class="",t.isModal=!0,t.isDraggable=!0,t.winHeight=768<screen.height?_win.innerHeight||_doc.documentElement.clientHeight||_doc.body.clientHeight:432,t.title="",t.body="",t.buttons={okDlg:{label:"OK",onClick:"close",class:"ok"}},t.buttonEnabled=!0,t.onClose=null,t._init(e)}function initializeLazyImages(e){e&&(_.lazyImage={list:e,sources:{}},_.lazyImage.list.forEach(function(e){e.addEvent("update",function(){var e=_win.pageYOffset+_win.innerHeight-1;this.offsetTop<e&&(null!=(e=this.removeClass("lazyImage").previousSibling)&&"NOSCRIPT"==e.tagName&&null!=(e=/src=['"]([^'"]+)['"]/i.exec(e.innerHTML))&&(this.src=e[1],_.lazyImage.sources[this.id]=1))})}),_win.addEvent("scroll",function(){_.lazyImage.list.forEach(function(e,t){e.id||(e.id="lazyImage"+t),_.lazyImage.sources[e.id]||e.trigger("update")})}))}function activeLoader(e){var t=_qs("body"),o="pageLoader",r=_$(o);if(e==_u||e)null==r&&((e=_new("div")).id=o,e.className="loadingLayer",e.innerHTML="<div class='ball1'></div><div class='ball2'></div>",e.style.height=t.scrollHeight+"px",t.appendChild(e),o=_qs("#pageLoader > .ball1"),e=_win.pageYOffset+_win.innerHeight/2-o.offsetTop+"px",o.style.top=e,_qs("#pageLoader > .ball2").style.top=e);else if(null!=r)try{t.removeChild(r)}catch(e){}}Draggable.prototype={init:function(e){var t=this,o=t.body,r=t.dragOffset,n=t.tag,a=n.querySelector(".bar");a.addEvent("mousedown",function(e){t.isDragging=!0,e.pageX=(e.pageX||e.clientX)+o.scrollLeft,e.pageY=(e.pageY||e.clientY)+o.scrollTop,r={x:e.pageX-n.offsetLeft,y:e.pageY-n.offsetTop},e.buttons==_u&&document.addEvent("mousemove",function(e){0!=e.buttons&&0!=e.which||!t.isDragging||(e.pageX=e.pageX||e.clientX+o.scrollLeft,e.pageY=e.pageY||e.clientY+o.scrollTop,n.style.top=e.pageY-r.y+"px",n.style.left=e.pageX-r.x+"px",t.isDragging=!1)})}),a.addEvent("mousemove",function(e){0!=e.buttons&&0!=e.which||(t.isDragging=!1)}),e.addEvent("mousemove",function(e){t.isDragging&&(e.pageX=e.pageX||e.clientX+o.scrollLeft,e.pageY=e.pageY||e.clientY+o.scrollTop,n.style.top=e.pageY-r.y+"px",n.style.left=e.pageX-r.x+"px")}),e.addEvent("mouseup",function(e){t.isDragging=!1})}},Dialog.prototype._init=function(p){for(var parms=["id","class","bodyId","footerId","isModal","top","left","title","body","buttons","buttonEnabled","focusId","onClose"],n=parms.length,o=this,dlg=_new("div"),btns="",i,i=0;i<n;i++)p[parms[i]]!==_u&&(o[parms[i]]=p[parms[i]]);if(o.buttonEnabled)for(i in o.buttons)btns+="<button type='button' id='"+i+"Btn'"+(o.buttons[i].class?" class='"+o.buttons[i].class+"'":"")+">"+o.buttons[i].label+"</button>";o.isModal&&(dlg.className="modal");for(var jsRe=/<script[^>]*>([.\s\S]+?)<\/script>/g,js="",a;null!=(a=jsRe.exec(o.body));)js+=a[1];o.body=o.body.replace(jsRe,"").replace(/^\s+/,""),"<"!=o.body.charAt(0)&&(o.body="<p>"+o.body+"</p>"),dlg.innerHTML="<div id='"+o.id+"' class='dialog"+(""!=o.class?" "+o.class:"")+"' style=''><div class='bar'>"+o.title+"</div><div"+(o.bodyId?" id='"+o.bodyId+"'":"")+" class='body' style='max-height:"+o.winHeight+"px'>"+o.body+"</div><div"+(o.footerId?" id='"+o.footerId+"'":"")+" class='footer'>"+(o.buttonEnabled?"<p class='buttons'>"+btns+"</p>":"")+"</div></div>";var action=dlg.querySelector(".action"),buttons,body,footer,notice;if(o.buttonEnabled&&null!=action&&(buttons=dlg.querySelector(".buttons"),body=null!=action?action.parentNode:dlg.querySelector(".body"),footer=buttons.parentNode,notice=body.querySelector(".notice"),footer.appendChild(body.removeChild(action)),null!=notice&&footer.appendChild(notice),footer.removeChild(buttons)),document.body.appendChild(o.modal=dlg),o.refreshPosition(),o.buttonEnabled)for(i in o.buttons){var btn=_$(i),t;null==btn&&(btn=_$(i+"Btn")),null!=btn&&(t=typeof o.buttons[i].onClick,"function"==t?(btn.__close=o.close.bind(o),btn.__click=o.buttons[i].onClick,btn.addEvent("click",function(){this.__click()&&this.__close()})):"string"==t&&btn.addEvent("click",o[o.buttons[i].onClick].bind(o)))}try{p.init!==_u&&"function"==typeof p.init?p.init():null!=action?action.querySelector(":last-child").focus():o.buttonEnabled&&dlg.querySelector(".buttons>:last-child").focus()}catch(e){}""!=js&&eval(js),o.isDraggable&&new Draggable(o.id)},Dialog.prototype.refreshPosition=function(){var e=this,t=_$(e.id),o=t.offsetHeight;o>e.winHeight&&(o=e.winHeight,t.style.maxHeight=e.winHeight+"px",t.querySelector(".body").style.maxHeight=e.winHeight-t.querySelector(".bar").offsetHeight-t.querySelector(".footer").offsetHeight-48+"px"),t.style.left=e.left||((_win.innerWidth||_doc.documentElement.clientWidth||_doc.body.clientWidth)-t.offsetWidth)/2+"px",t.style.top=e.top||(e.winHeight-o)/2+"px"},Dialog.prototype.close=function(){var e=this,t=e.focusId?_$(e.focusId):null;e.modal.parentNode.removeChild(e.modal),null!==t&&t.focus(),e.onClose&&e.onClose()};